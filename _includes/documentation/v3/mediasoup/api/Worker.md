## Worker
{: #Worker}

<section markdown="1">

A worker represents a mediasoup C++ subprocess that runs in a single CPU core and handles [Router](#Router) instances.

</section>


### Dictionaries
{: #Worker-dictionaries}

<section markdown="1">

#### WorkerSettings
{: #WorkerSettings .code}

<div markdown="1" class="table-wrapper L3 M5">

Field                    | Type    | Description   | Required | Default
------------------------ | ------- | ------------- | -------- | ---------
`logLevel`               | [WorkerLogLevel](#WorkerLogLevel) | Logging level for logs generated by the media worker subprocesses (check the [Debugging](/documentation/v3/mediasoup/debugging/) documentation). Valid values are "debug", "warn", "error" and "none". | No | "error"
`logTags`                | Array&lt;[WorkerLogTag](#WorkerLogTag)&gt; | Log tags for debugging. Check the list of available tags in [Debugging](/documentation/v3/mediasoup/debugging/) documentation. | No | `[ ]`
`rtcMinPort`             | Number  | Minimun RTC port for ICE, DTLS, RTP, etc. | No | 10000
`rtcMaxPort`             | Number  | Maximum RTC port for ICE, DTLS, RTP, etc. | No | 59999
`dtlsCertificateFile`    | String  | Path to the DTLS public certificate file in PEM format. If unset, a certificate is dynamically created. | No |
`dtlsPrivateKeyFile`     | String  | Path to the DTLS certificate private key file in PEM format. If unset, a certificate is dynamically created. | No |
`appData`                 | Object  | Custom application data. | No | `{ }` |

</div>

<div markdown="1" class="note">
RTC listening IPs are not set at worker level. Instead, they are set per individual transport.
</div>

#### WorkerUpdateableSettings
{: #WorkerUpdateableSettings .code}

<div markdown="1" class="table-wrapper L3">

Field                    | Type    | Description   | Required | Default
------------------------ | ------- | ------------- | -------- | ---------
`logLevel`               | String  | Logging level for logs generated by the media worker subprocesses (check the [Debugging](/documentation/v3/mediasoup/debugging/) documentation). Valid values are "debug", "warn", "error" and "none". | No | "error"
`logTags`                | Array&lt;String&gt; | Log tags for debugging. Check the list of available tags in [Debugging](/documentation/v3/mediasoup/debugging/) documentation. | No |

</div>

#### WorkerResourceUsage
{: #WorkerResourceUsage .code}

An object with the fields of the [uv_rusage_t](http://docs.libuv.org/en/v1.x/misc.html#c.uv_rusage_t) struct.

<div markdown="1" class="note">
Both `ru_utime` and `ru_stime` values are given in milliseconds.
</div>

</section>


### Enums
{: #Worker-enums}

<section markdown="1">

#### WorkerLogLevel
{: #WorkerLogLevel .code}

<div markdown="1" class="table-wrapper L2">

Value    | Description  
-------- | -------------
"debug"  | Log all severities.
"warn"   | Log "warn" and "error" severities.
"error"  | Log "error" severity.
"none"   | Do not log anything.

</div>

#### WorkerLogTag
{: #WorkerLogTag .code}

<div markdown="1" class="table-wrapper L2">

Value       | Description  
----------- | -------------
"info"      | Logs about software/library versions, configuration and process information.
"ice"       | Logs about ICE.
"dtls"      | Logs about DTLS.
"rtp"       | Logs about RTP.
"srtp"      | Logs about SRTP encryption/decryption.
"rtcp"      | Logs about RTCP.
"rtx"       | Logs about RTP retransmission, including NACK/PLI/FIR.
"bwe"       | Logs about transport bandwidth estimation.
"score"     | Logs related to the scores of Producers and Consumers.
"simulcast" | Logs about video simulcast.
"svc"       | Logs about video SVC.
"sctp"      | Logs about SCTP (DataChannel).
"message"   | Logs about messages (can be SCTP messages or direct messages).

</div>

</section>

### Properties
{: #Worker-properties}

<section markdown="1">

#### worker.pid
{: #worker-pid .code}

The PID of the worker process.

> `@type` Number, read only

```javascript
console.log(worker.pid);
// => 86665
```

#### worker.closed
{: #worker-closed .code}

Whether the worker is closed.

> `@type` Boolean, read only

```javascript
console.log(worker.closed);
// => false
```

#### worker.appData
{: #worker-appData .code}

Custom data Object provided by the application in the worker factory method. The app can modify its content at any time.

> `@type` Object, read only

#### worker.observer
{: #worker-observer .code}

See the [Observer Events](#Worker-observer-events) section below.

> `@type` [EventEmitter](https://nodejs.org/api/events.html#events_class_eventemitter), read only

</section>


### Methods
{: #Worker-methods}

<section markdown="1">

#### worker.close()
{: #worker-close .code}

Closes the worker. Triggers a ["workerclose"](#router-on-workerclose) event in all its routers.

#### worker.getResourceUsage()
{: #worker-getResourceUsage .code}

Provides resource usage of the mediasoup-worker subprocess.

> `@async`
> 
> `@returns` [WorkerResourceUsage](#WorkerResourceUsage)

```javascript
const usage = await worker.getResourceUsage();

// =>
{
  ru_idrss: 0,
  ru_inblock: 0,
  ru_isrss: 0,
  ru_ixrss: 0,
  ru_majflt: 0,
  ru_maxrss: 46047232,
  ru_minflt: 11446,
  ru_msgrcv: 23641,
  ru_msgsnd: 40005,
  ru_nivcsw: 27926,
  ru_nsignals: 0,
  ru_nswap: 0,
  ru_nvcsw: 0,
  ru_oublock: 0,
  ru_stime: 1026,
  ru_utime: 3066
}
```

#### worker.updateSettings(settings)
{: #worker-updateSettings .code}

Updates the worker settings in runtime. Just a subset of the worker settings can be updated.

<div markdown="1" class="table-wrapper L3">

Argument   | Type    | Description | Required | Default 
---------- | ------- | ----------- | -------- | ----------
`settings` | [WorkerUpdateableSettings](#WorkerUpdateableSettings) | Worker updateable settings. | No |

</div>

> `@async`

```javascript
await worker.updateSettings({ logLevel: "warn" });
```

#### worker.createRouter(options)
{: #worker-createRouter .code}

Creates a new router.

<div markdown="1" class="table-wrapper L3">

Argument      | Type    | Description | Required | Default 
------------- | ------- | ----------- | -------- | ----------
`options`     | [RouterOptions](#RouterOptions) | Router options. | Yes |

</div>

> `@async`
> 
> `@returns` [Router](#Router)

```javascript
const mediaCodecs =
[
  {
    kind        : "audio",
    mimeType    : "audio/opus",
    clockRate   : 48000,
    channels    : 2
  },
  {
    kind       : "video",
    mimeType   : "video/H264",
    clockRate  : 90000,
    parameters :
    {
      "packetization-mode"      : 1,
      "profile-level-id"        : "42e01f",
      "level-asymmetry-allowed" : 1
    }
  }
];

const router = await worker.createRouter({ mediaCodecs });
```

#### worker.createWebRtcServer(options)
{: #worker-createWebRtcServer .code}

Creates a new WebRTC server.

<div markdown="1" class="table-wrapper L3">

Argument      | Type    | Description | Required | Default 
------------- | ------- | ----------- | -------- | ----------
`options`     | [WebRtcServerOptions](#WebRtcServerOptions) | WebRTC server options. | Yes |

</div>

> `@async`
> 
> `@returns` [WebRtcServer](#WebRtcServer)

```javascript
const webRtcServer = await worker.createWebRtcServer(
  {
    listenInfos :
    [
      {
        protocol : 'udp',
        ip       : '9.9.9.9',
        port     : 20000
      },
      {
        protocol : 'tcp',
        ip       : '9.9.9.9',
        port     : 20000
      }
    ]
  });
```

</section>


### Events
{: #Worker-events}

<section markdown="1">

#### worker.on("died", fn(error))
{: #worker-on-died .code}

Emitted when the worker process unexpectedly dies.

<div markdown="1" class="table-wrapper L3">

Argument | Type    | Description
---------| ------- | -----------
`error`  | Error   | Originating error.

</div>

<div markdown="1" class="note warn">
This should never happens. If it happens, it's a bug. Please report it following these [instructions](/support/#crashes-in-mediasoup-get-a-core-dump).
</div>

```javascript
worker.on("died", (error) =>
{
  console.error("mediasoup worker died!: %o", error);
});
```

</section>


### Observer Events
{: #Worker-observer-events}

<section markdown="1">

<div markdown="1" class="note">
See the [Observer API](#observer-api) section below.
</div>

#### worker.observer.on("close", fn())
{: #worker-observer-on-close .code}

Emitted when the worker is closed for whatever reason.

#### worker.observer.on("newrouter", fn(router))
{: #worker-observer-on-newrouter .code}

Emitted when a new router is created.

<div markdown="1" class="table-wrapper L3">

Argument | Type    | Description   
-------- | ------- | ----------------
`router` | [Router](#Router) | New router.

</div>

```javascript
worker.observer.on("newrouter", (router) =>
{
  console.log("new router created [id:%s]", router.id);
});
```

#### worker.observer.on("newwebrtcserver", fn(router))
{: #worker-observer-on-newwebrtcserver .code}

Emitted when a new router is created.

<div markdown="1" class="table-wrapper L3">

Argument | Type    | Description   
-------- | ------- | ----------------
`webRtcServer` | [WebRtcServer](#WebRtcServer) | New WebRTC server.

</div>

```javascript
worker.observer.on("newwebrtcserver", (webRtcServer) =>
{
  console.log("new WebRTC server created [id:%s]", webRtcServer.id);
});
```

</section>
